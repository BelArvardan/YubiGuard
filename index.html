<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>YubiGuard by bfelder</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>YubiGuard</h1>
        <p>Python script to prevent accidental triggering of YubiKeys on Linux.</p>

        <p class="view"><a href="https://github.com/bfelder/YubiGuard">View the Project on GitHub <small>bfelder/YubiGuard</small></a></p>


        <ul>
          <li><a href="https://github.com/bfelder/YubiGuard/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/bfelder/YubiGuard/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/bfelder/YubiGuard">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a id="yubiguard" class="anchor" href="#yubiguard" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>YubiGuard</h1>

<p>Python script to protect against accidental triggering of YubiKeys on Linux.</p>

<p>Most recent version: 0.9</p>

<p>A predecessor called <a href="https://github.com/gsstark/yubiswitch-for-linux">YubiSwitch</a> tried to solve the same problem, but came with major security flaws, was cumbersome to use and lacked several important features.</p>

<h2>
<a id="advantages-over-yubiswitch" class="anchor" href="#advantages-over-yubiswitch" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Advantages over YubiSwitch:</h2>

<ol>
<li><strong>No root privilege required to run!</strong></li>
<li><strong>No unintended output release after reactivation, if you pressed your YubiKey while locked!</strong></li>
<li>Detects YubiKeys automatically, no need to hardcode ids manually.</li>
<li>Can handle multiple YubiKeys concurrently.</li>
<li>Timeout which locks off YubiKey after 5 seconds.</li>
<li>Automatically locking after YubiKey has been triggered.</li>
<li>Panel indicator showing the activation status of YubiKey(s).</li>
</ol>

<h2>
<a id="installation--setup" class="anchor" href="#installation--setup" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Installation &amp; Setup</h2>

<ol>
<li>Download zip archive here: <a href="https://github.com/bfelder/YubiGuard/zipball/master%5B">ZIP</a>
</li>
<li>Extract files.</li>
<li>Install dependencies.</li>
<li>Run YubiGuard.py.</li>
<li>Bind system key combination to the same file, but with <strong>"-t"</strong> as command line parameter.</li>
<li>This key combinatin is used to unlock YubiKeys (See: Usage for further instructions.)</li>
</ol>

<h3>
<a id="requirements" class="anchor" href="#requirements" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Requirements:</h3>

<ul>
<li>xinput (installed on most Linux distributions by default)</li>
<li>gir1.2-gtk-3.0</li>
<li>gir1.2-appindicator3</li>
<li>pyzmq</li>
</ul>

<pre><code>sudo pip install pyzmq
</code></pre>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Usage:</h2>

<ul>
<li>YubiLock locks output from all inserted YubiKeys by default.</li>
<li>The locked state is indicated in the panel by the default icon.</li>
<li>Simply Triggering via key combination (e.g.: super + y) will unlock YubiKey.</li>
<li>In the unlocked state the icon changes to green.</li>
<li>After triggering your YubiKey or after timeout, YubiKey will again be locked with the icon reverting back to default.</li>
<li>While no YubiKeys are inserted, the panel indicator will be darkened.</li>
</ul>

<h2>
<a id="faq" class="anchor" href="#faq" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>FAQ:</h2>

<p><strong><em>Q:</em></strong> The LED of my YubiKey is still active. Does this mean the script is not working?
<strong><em>A:</em></strong> No. LEDs will continue to blink, despite YubiKey output being blocked as intended.</p>

<p><strong><em>Q:</em></strong> How does YubiLock actiavte and deactivate YubiKeys?
<strong><em>A:</em></strong> YubiLock uses the xinput command to identify and control the output of YubiKeys. Namely:
<em>xinput list</em>, <em>xinput --enable </em>, <em>xinput --disable </em> and <em>xinput test </em>.</p>

<h2>
<a id="tested-on" class="anchor" href="#tested-on" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Tested on:</h2>

<h3>
<a id="linux-distributions-all-64-bit" class="anchor" href="#linux-distributions-all-64-bit" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Linux Distributions (all 64-bit):</h3>

<p><em>(Only checked working of xinput command and correct panel indicator display so far.)</em></p>

<ul>
<li>Xubuntu 15.10 (Wily Werewolf)</li>
<li>Xubuntu 16.04 (Xenial Xerus)</li>
<li>Elementary OS 0.4</li>
<li>Fedora 24</li>
<li>Linux Mint 18 (Cinnamon)</li>
<li>Manjaro Linux 15.09</li>
<li>Ubuntu 16.04</li>
</ul>

<h3>
<a id="not-working-on-all-64-bit" class="anchor" href="#not-working-on-all-64-bit" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Not working on (all 64-bit):</h3>

<p><em>(Those distros are not working as xinput is not installed: "xinput: command not found".
One might get YubiGuard to run with additional work though.)</em></p>

<ul>
<li>Debian 8.5 (Jessie)</li>
<li>OpenSUSE 42.1</li>
<li>Solus 1.2</li>
<li>Mageia 5</li>
</ul>

<h3>
<a id="yubikey-models" class="anchor" href="#yubikey-models" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>YubiKey models:</h3>

<ul>
<li>YubiKey 4 Nano</li>
<li>YubiKey NEO</li>
<li>YubiKey II</li>
</ul>

<h2>
<a id="credits" class="anchor" href="#credits" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Credits:</h2>

<ul>
<li>Yubico generously provided additional YubiKey models for testing.</li>
<li>Stefaan Lippens' asynchronous stdout pipe allowed for an non-blocking way to monitor YubiKey output:
stefaanlippens.net/python-asynchronous-subprocess-pipe-reading</li>
</ul>

<h2>
<a id="changelog" class="anchor" href="#changelog" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Changelog:</h2>

<h3>
<a id="v-02" class="anchor" href="#v-02" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>v 0.2:</h3>

<ul>
<li>renamed to YubiLock, as this name better portrays the function</li>
<li>instead of text notificaions, now descriptive icons are displayed</li>
<li>in case of changing xinput ids (e.g. devices are switched) old ids will be automatically activated</li>
</ul>

<h3>
<a id="v-03" class="anchor" href="#v-03" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>v 0.3</h3>

<ul>
<li>beautified icons</li>
<li>set working dir, to always allow relative import of icons</li>
<li>now preventing overtriggering when hitting key combinations in short succession</li>
</ul>

<h3>
<a id="v-04" class="anchor" href="#v-04" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>v 0.4</h3>

<ul>
<li>added exit handler, which will reactivate YubiKeys after script has exited</li>
</ul>

<h3>
<a id="v-05" class="anchor" href="#v-05" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>v 0.5</h3>

<ul>
<li>code rectified</li>
<li>introduced missing thread locking</li>
</ul>

<h3>
<a id="v-06-major-update" class="anchor" href="#v-06-major-update" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>v 0.6 (major update)</h3>

<ul>
<li>added a Panel Indicator (replacing notification of LOCK/UNLOCK)</li>
<li>major rectification of code</li>
<li>switched from thread based concurrency to process based for superb responsiveness</li>
<li>added key event listener, replacing triggering via external script over zmq</li>
<li>added settings.ini to grant user to customize time out and triggering key combination</li>
<li>eliminated minor bugs which led to laggy or unreliable unlocking</li>
</ul>

<h3>
<a id="v-07" class="anchor" href="#v-07" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>v 0.7</h3>

<ul>
<li>switched back from KeyEventListener to ZmqListener, as the former interfered with YubiKey release (see issue)</li>
</ul>

<h3>
<a id="v-08" class="anchor" href="#v-08" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>v 0.8</h3>

<ul>
<li>changed name back to YubiGuard, as two other GitHub projects are already titled YubiLock</li>
<li>updated icons</li>
<li>minor rectifivation of code</li>
</ul>

<h3>
<a id="v-09" class="anchor" href="#v-09" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>v 0.9</h3>

<ul>
<li>YubiGuard.py itself is now used for triggering, when run with command line paramater: '-t'. (yg_trigger.sh removed)</li>
<li>fixed minor bug preventing exit when no keys were inserted</li>
</ul>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/bfelder">bfelder</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>
